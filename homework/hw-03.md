1.  
  
> Приложите скриншот входящих правил "Группы безопасности" в ЛК Yandex Cloud или скриншот отказа в предоставлении доступа к preview версии.  
  
Результат в облаке:  
![alt-текст](https://github.com/kategrinchik/devops-netology/blob/terraform-03/homework/images/sec.jpeg)  
  
2.  
  
> Создайте файл count-vm.tf. Опишите в нем создание двух одинаковых виртуальных машин с минимальными параметрами, используя мета-аргумент count loop.  

Содержимое файла count-vm.tf:  
  
```Ruby
data "yandex_compute_image" "ubuntu-2004-lts" {
  family = "ubuntu-2004-lts" 
}

resource "yandex_compute_instance" "count_VM" {
  name        = "homework03-develop-platform-web-${count.index}"
  platform_id = "standard-v1"
  
  count = 2

  resources {
    cores  = 2
    memory = 1
    core_fraction = 5
  }
  
  boot_disk {
    initialize_params {
      image_id = data.yandex_compute_image.ubuntu-2004-lts.image_id
      type = "network-hdd"
      size = 5
    }   
  }
  
  metadata = {
    ssh-keys = "ubuntu:${local.metadata.ssh-keys}"
  }
  
  scheduling_policy { preemptible = true }
  
  network_interface { 
    subnet_id = yandex_vpc_subnet.develop.id
    nat       = true
  }
  allow_stopping_for_update = true
}#
```
  
> Создайте файл for_each-vm.tf. Опишите в нем создание 2 разных по cpu/ram/disk виртуальных машин, используя мета-аргумент for_each loop. Используйте переменную типа list(object({ vm_name=string, cpu=number, ram=number, disk=number })). При желании внесите в переменную все возможные параметры.  
> ВМ из пункта 2.2 должны создаваться после создания ВМ из пункта 2.1.  
  
Содержимое файла for_each-vm.tf:  
  
```Ruby
resource "yandex_compute_instance" "foreach_VM" {
  for_each   = {
    for index, vm in local.virtual_machines:
    index => vm
  }
  name       = each.value.vm_name
  depends_on = [
    yandex_compute_instance.count_VM,
  ]
  platform_id = "standard-v1"

  resources {
    cores  = 2
    memory = each.value.ram
    core_fraction = 20
  }

  boot_disk {
    initialize_params {
      image_id = data.yandex_compute_image.ubuntu-2004-lts.image_id
      type = "network-hdd"
      size = each.value.disk
    }
  }
  
  metadata = {
    ssh-keys = "ubuntu:${local.metadata.ssh-keys}"
  }
  
  scheduling_policy { preemptible = true }
  
  network_interface { 
    subnet_id = yandex_vpc_subnet.develop.id
    nat       = true
  }
  allow_stopping_for_update = true
}#
```
  
> Используйте функцию file в local переменной для считывания ключа ~/.ssh/id_rsa.pub и его последующего использования в блоке metadata, взятому из ДЗ №2.  
  
В прошлом ДЗ была рекомендация не использовать ключи rsa.  
Содержимое файла locals.tf:
  
```Ruby
locals {
  metadata = {
    ssh-keys = file("~/.ssh/id_ed25519.pub")
  }
}

locals {
  virtual_machines = [
    { 
      vm_name = "homework03-develop-platform-db-0"
      cpu     = 2
      ram     = 1
      disk    = 10
    },
    {
      vm_name = "homework03-develop-platform-db-1"
      cpu     = 2
      ram     = 2
      disk    = 15
    }  
  ]
} 
```
  
Результат выполнения terraform apply в облаке:  
![alt-текст](https://github.com/kategrinchik/devops-netology/blob/terraform-03/homework/images/yc3.jpeg) 
  
3.  
  
